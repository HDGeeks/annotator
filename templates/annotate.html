<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Annotate Row {{ idx+1 }}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f5f6fa;
            padding: 30px;
        }
        .card {
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        }
        .input-box {
            white-space: pre-wrap;
            background: #eef1f7;
            border-left: 4px solid #4a6cf7;
            padding: 12px;
            border-radius: 6px;
            font-size: 1.05rem;
        }
        label {
            margin-top: 10px;
            font-weight: 600;
            opacity: 0.85;
        }
        .progress-bar {
            background: linear-gradient(90deg, #4a6cf7, #6a89ff);
        }
        .annotation-box {
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e6e6ee;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="card p-4">

        <h3 class="mb-3">Annotating Row {{ idx+1 }} / {{ total }}</h3>

        <!-- Progress bar -->
        <div class="progress mb-4" style="height: 10px;">
            <div class="progress-bar" role="progressbar"
                 style="width: {{ ((idx + 0.0001)/total)*100 }}%;">
            </div>
        </div>

        <h5 class="mb-2 text-muted">Input text</h5>
        <div class="input-box mb-4">
            {{ row.input }}
        </div>

        <form method="POST">
            <input type="hidden" name="total_items" value="{{ row.output|length }}">

            {% for item in row.output %}
                <div class="annotation-box p-3 mb-4">
                    <h6 class="fw-bold mb-3">Annotation {{ loop.index }}</h6>

                    {# --------------------- #}
                    {# ASPECT                 #}
                    {# --------------------- #}
                    <label>Aspect</label>
                    <select name="aspect_{{ loop.index0 }}" class="form-select">
                        {% for a in aspects %}
                            <option value="{{ a }}" {% if item.aspect == a %}selected{% endif %}>
                                {{ a }}
                            </option>
                        {% endfor %}
                    </select>

                    {# --------------------- #}
                    {# POLARITY              #}
                    {# --------------------- #}
                    <label>Polarity</label>
                    <select name="polarity_{{ loop.index0 }}" class="form-select">
                        {% for p in polarity_options %}
                            <option value="{{ p }}" {% if item.polarity == p %}selected{% endif %}>
                                {{ p }}
                            </option>
                        {% endfor %}
                    </select>

                    {# --------------------- #}
                    {# EMOTION FILTERED BY ASPECT #}
                    {# --------------------- #}

                    {% set selected_aspect = item.aspect %}

                    <label>Emotion (filtered by aspect)</label>
                    <select name="emotion_{{ loop.index0 }}" class="form-select">

                        <!-- None -->
                        <option value=""
                            {% if item.emotion == "" or item.emotion == None %}selected{% endif %}>
                            None
                        </option>

                        <!-- SUGGESTED EMOTIONS FOR THIS ASPECT -->
                        {% if selected_aspect in emotions %}
                        <optgroup label="Suggested for '{{ selected_aspect }}'">
                            {% for pol, emo_list in emotions[selected_aspect].items() %}
                                {% for emo in emo_list %}
                                    <option value="{{ emo }}"
                                        {% if item.emotion == emo %}selected{% endif %}>
                                        {{ emo }} ({{ pol }})
                                    </option>
                                {% endfor %}
                            {% endfor %}
                        </optgroup>
                        {% endif %}

                        <!-- GLOBAL POSITIVE -->
                        <optgroup label="All Positive Emotions">
                            {% for emo in emotions['positive'] %}
                                <option value="{{ emo }}"
                                    {% if item.emotion == emo %}selected{% endif %}>
                                    {{ emo }}
                                </option>
                            {% endfor %}
                        </optgroup>

                        <!-- GLOBAL NEGATIVE -->
                        <optgroup label="All Negative Emotions">
                            {% for emo in emotions['negative'] %}
                                <option value="{{ emo }}"
                                    {% if item.emotion == emo %}selected{% endif %}>
                                    {{ emo }}
                                </option>
                            {% endfor %}
                        </optgroup>

                        <!-- GLOBAL NEUTRAL -->
                        <optgroup label="All Neutral Emotions">
                            {% for emo in emotions['neutral'] %}
                                <option value="{{ emo }}"
                                    {% if item.emotion == emo %}selected{% endif %}>
                                    {{ emo }}
                                </option>
                            {% endfor %}
                        </optgroup>

                    </select>

                </div> <!-- annotation-box -->
            {% endfor %}

            <button class="btn btn-success w-100 py-2 mt-3">
                Save & Next â†’
            </button>
        </form>

    </div>
</div>

</body>
</html>